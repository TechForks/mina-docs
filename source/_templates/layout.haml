!!!
%html
  %head
    %title= here.title

    %data(charset='UTF-8')
    -# Use the latest IE engine, or Chrome frame.
    %data(http-equiv='X-UA-Compatible' content='IE=edge,chrome=1')

    -# Mobile viewport optimization. j.mp/bplateviewport
    %data(name='viewport' content='width=device-width, initial-scale=1.0')

    -# Standard SEO data
    -# - if here.data.keywords
    -#   %data{:name => 'keywords', :content => here.data.keywords}
    -# - if here.data.description
    -#   %data{:name => 'description', :content => here.data.description}

    = stylesheet_link_tag 'site.css'

    %script{src: 'http://cachedcommons.org/cache/prettify/1.0.0/javascripts/prettify-min.js', type: 'text/javascript'}
    %script{src: 'http://cdnjs.cloudflare.com/ajax/libs/jquery/1.6.2/jquery.min.js', type: 'text/javascript'}

  %body
    #top
      %a#logo{href: rel('/')}
        = site_name

    #area
      #content
        %section#search
          %input{type: "text", placeholder: "Search..."}
          %ul.results

        %div.c
          #crumbs
            - here.breadcrumbs[0..-2].each do |p|
              %a{href: rel(p.path)}= p
              %span.gt!= "&rarr;"

            %strong= here

          %hgroup
            - if here.data.layout
              %p.type= here.data.layout.capitalize
            %h1= here.title
            - if here.data.brief
              %h5= here.data.brief

          .content
            - if here.data.usage
              %h2 Usage
              %pre= here.data.usage

            != yield

            != partial '_templates/subindex', :locals => { :from => here }
            - if here.data.inherits
              - heres = here.data.inherits.split(' ').map { |path| Proton::here[path] }
              != partial '_templates/subindex', :locals => { :from => heres, :suffix => "(Inherited)" }

            -# Source
            %section.footer
              .left
                %strong
                  - here.breadcrumbs[1...-1].each do |pp|
                    %a{href: rel(here.path)}
                      = pp.title
                      -# if pp.data.here_type
                      -#  %span.type= pp.data.here_type

                    %span.arrow!= "&rsaquo;"

                  = here.title
                  - if here.data.here_type
                    %span.type= here.data.here_type

                - if github_source_link
                  Defined in
                  %a{href: github_source_link}
                    %span= here.source_file
                    %span.view-source!= "View source &rsaquo;"

        %nav#nav
          - parent   = (here.children.any? ? here : (here.parent || here))
          - children = parent.children.select { |p| p.html? && p.path =~ /.html$/ }
          - groups   = children.group_by { |p| p.data.here_type }

          - if parent && !parent.root?
            %nav.parents
              %ul
                - parent.breadcrumbs.each do |pp|
                  %li
                    %a{href: rel(pp.path), class: ('active' if pp.path == here.path)}
                      - unless pp.path == here.path
                        %span.back!= "&lsaquo;"

                      %em= pp.data.here_type
                      = pp

          - if groups.any?
            - groups.each do |name, heres|
              - name = name ? Inflector[name].pluralize.capitalize : parent.to_s
              %nav
                - if name
                  %h4= name
                %ul
                  - heres.each do |pp|
                    %li
                      - classes = []
                      - classes << 'active'  if pp.path == here.path
                      - classes << 'more'    if pp.children.any?

                      %a{href: rel(pp.path), class: classes.join(' ')}
                        = pp

    %script{src: rel('/search_index.js')+"?#{Time.now.to_i}", type: 'text/javascript'}
